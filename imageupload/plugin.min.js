!function(){tinymce.create("tinymce.plugins.ImageUploadPlugin",{init:function(e,a){a=tinyMCE.activeEditor.getParam("imageupload_rel")||a;var o=tinyMCE.activeEditor.getParam("imageupload_url"),i=document.getElementsByTagName("body")[0],n=document.createElement("link"),t=$("input[name='param-string']");n.type="text/css",n.rel="stylesheet",n.href=a+"/css/style.css",i.appendChild(n),t&&(o+="?"+t.val()),e.addCommand("mceImageUpload",function(){$("#image_upload_type").val("tinymce"),$("body").append('<div class="imageUploadBg"></div>');var a=function(e){$(".imageUploadError").html(e).show(),i()},i=function(){$(".imageUploadFg").remove(),$(".imageUploadFgLoading").remove()},n=function(){$(".imageUploadBg").remove(),$(".imageUploadContainer").remove()},t='          <div class="imageUploadContainer mce-container mce-panel mce-window">            <div class="imageUploadContainerInner">              <div class="mce-window-head">                <div class="mce-title">Upload Image</div>                <button type="button" class="mce-close">Ã—</button>              </div>              <form action="'+o+'" method="POST" enctype="multipart/form-data" id="uploadImageForm">              <div class="mce-container imageUploadFormContainer" hidefocus="1" tabindex="-1">                <div class="mce-container-body">                  <input type="file" name="file" id="image-upload-area" accept="image/*" class="mce-placeholder" hidefocus="true" style="width: 258px;">                </div>                <p class="imageUploadError"></p>              </div>              </form>              <div class="imageUploadConfirmCase mce-panel">                <div class="mce-btn mce-primary">                  <button role="presentation" class="imageUploadSubmit">Upload</button>                </div>                <div class="mce-btn">                  <button role="presentation" class="imageUploadClose">Close</button>                </div>              </div>            </div>          </div>        ';$("body").append(t),$(".imageUploadBg, .imageUploadContainer .imageUploadClose, .mce-close").on("click",function(){i(),n()}),$("#uploadImageForm").iframePostForm({json:!0,post:function(){},complete:function(o){if("object"!=typeof o||null==o||"undefined"==typeof o.error)i(),a("An error occurred while uploading your image.");else if(0!=o.error)switch(o.error){case"filetype":a("Please select a valid image and try again.");break;default:a("An unknown error occurred.")}else if("undefined"!=typeof o.path){var t='<img src="%s" />';e.insertContent(t.replace("%s",o.path)),e.focus(),i(),n()}else a("An unknown error occurred.")}}),$(".imageUploadSubmit").on("click",function(){$(".imageUploadError").html("").hide(),""!=$("#image-upload-area").val()?($("body").append('<div class="imageUploadFg"></div>'),$("body").append('<div class="imageUploadFgLoading"></div>'),$("#uploadImageForm").submit()):a("Please select an image to upload.")})}),e.addButton("imageupload",{title:"Image Upload",cmd:"mceImageUpload",image:a+"/img/icon.png"})},getInfo:function(){return{longname:"Image Upload",author:"BoxUK",authorurl:"https://github.com/boxuk/tinymce-imageupload",infourl:"https://github.com/boxuk/tinymce-imageupload/blob/master/README.md",version:"1.0.0"}}}),tinymce.PluginManager.add("imageupload",tinymce.plugins.ImageUploadPlugin)}();
